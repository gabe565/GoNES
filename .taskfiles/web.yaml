# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: '3'

tasks:
  npm:
    internal: true
    dir: web
    sources: [package*.json]
    cmd: npm install

  build-wasm:
    env:
      GOOS: js
      GOARCH: wasm
    cmds:
      - cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" web/src/scripts
      - go build -ldflags='-w -s' -trimpath -o web/src/assets/gones.wasm

  build:
    deps: [build-wasm, npm]
    dir: web
    cmd: npm run build

  serve:
    deps: [build-wasm, npm]
    dir: web
    cmd: npm run dev
